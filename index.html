<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Builder - Admin Panel & Player</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-bg-alt {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .gradient-bg-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .card-shadow-lg {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in {
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .pulse-button {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .8;
            }
        }
        
        .option-hover {
            transition: all 0.3s ease;
        }
        
        .option-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.2);
        }
        
        .option-selected {
            transform: scale(1.02);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .tab-active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }
        
        .admin-input {
            transition: all 0.2s ease;
        }
        
        .admin-input:focus {
            transform: translateY(-2px);
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .confetti {
            animation: confetti-fall 3s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(1000px) rotateZ(720deg);
                opacity: 0;
            }
        }
        
        /* Slider Styles */
        .quiz-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 12px;
            border-radius: 8px;
            background: #e5e7eb;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .quiz-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .quiz-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        
        .quiz-slider::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .quiz-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        
        /* Rating Stars */
        .rating-star {
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            filter: grayscale(100%);
            opacity: 0.3;
        }
        
        .rating-star.filled {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.1);
        }
        
        .rating-star:hover {
            transform: scale(1.2);
        }
        
        /* Yes/No Toggle */
        .toggle-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .toggle-option.active {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Quiz Templates Library
        const quizTemplates = {
            'business-coaching': {
                name: 'üíº Business Coaching',
                description: 'Perfect for coaches and consultants',
                template: {
                    branding: {
                        logo: "üíº",
                        brandName: "Business Growth Coach",
                        primaryColor: "#667eea",
                        secondaryColor: "#764ba2",
                        accentColor: "#f093fb"
                    },
                    welcome: {
                        title: "Discover Your Business Growth Potential!",
                        subtitle: "Take this quick assessment to get your personalized growth strategy",
                        buttonText: "Start Assessment ‚Üí",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "What's your biggest business challenge right now?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Getting more leads", icon: "üìà", score: 10 },
                                { id: "b", text: "Converting leads to customers", icon: "üí∞", score: 20 },
                                { id: "c", text: "Scaling operations", icon: "üöÄ", score: 30 },
                                { id: "d", text: "Team management", icon: "üë•", score: 40 }
                            ]
                        },
                        {
                            id: 2,
                            question: "How ready are you to invest in growth?",
                            type: "slider",
                            min: 0,
                            max: 100,
                            step: 10,
                            defaultValue: 50,
                            labels: { 0: "Not ready", 50: "Considering", 100: "Ready now!" }
                        },
                        {
                            id: 3,
                            question: "Are you committed to making a change?",
                            type: "yes-no",
                            yesLabel: "Yes, absolutely!",
                            noLabel: "Still exploring",
                            yesScore: 50,
                            noScore: 10
                        }
                    ]
                }
            },
            'fitness': {
                name: 'üí™ Fitness & Health',
                description: 'For fitness coaches and gyms',
                template: {
                    branding: {
                        logo: "üí™",
                        brandName: "Fitness Transformation",
                        primaryColor: "#ff6b6b",
                        secondaryColor: "#ee5a6f",
                        accentColor: "#c44569"
                    },
                    welcome: {
                        title: "Start Your Fitness Journey!",
                        subtitle: "Get a personalized workout and nutrition plan",
                        buttonText: "Let's Get Started! üí™",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "What's your primary fitness goal?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Lose weight", icon: "‚öñÔ∏è", score: 10 },
                                { id: "b", text: "Build muscle", icon: "üí™", score: 20 },
                                { id: "c", text: "Improve endurance", icon: "üèÉ", score: 30 },
                                { id: "d", text: "General health", icon: "‚ù§Ô∏è", score: 40 }
                            ]
                        },
                        {
                            id: 2,
                            question: "Rate your current fitness level",
                            type: "rating",
                            maxStars: 5,
                            labels: "1 = Beginner, 5 = Advanced"
                        },
                        {
                            id: 3,
                            question: "How motivated are you to start?",
                            type: "slider",
                            min: 0,
                            max: 100,
                            step: 10,
                            defaultValue: 75,
                            labels: { 0: "Just browsing", 50: "Interested", 100: "Ready now!" }
                        }
                    ]
                }
            },
            'real-estate': {
                name: 'üè† Real Estate',
                description: 'For realtors and property agents',
                template: {
                    branding: {
                        logo: "üè†",
                        brandName: "Dream Home Finder",
                        primaryColor: "#4a90e2",
                        secondaryColor: "#357abd",
                        accentColor: "#2e5c8a"
                    },
                    welcome: {
                        title: "Find Your Dream Home!",
                        subtitle: "Let's discover the perfect property for you",
                        buttonText: "Start Home Search üè°",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "Are you looking to buy or sell?",
                            type: "yes-no",
                            yesLabel: "Buy a home",
                            noLabel: "Sell my property",
                            yesScore: 50,
                            noScore: 40,
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 2,
                            question: "What's your timeline?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Within 30 days", icon: "‚ö°", score: 40, nextQuestion: null },
                                { id: "b", text: "Within 3 months", icon: "üìÖ", score: 30, nextQuestion: null },
                                { id: "c", text: "Within 6 months", icon: "üóìÔ∏è", score: 20, nextQuestion: null },
                                { id: "d", text: "Just researching", icon: "üîç", score: 10, nextQuestion: null }
                            ],
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 3,
                            question: "How serious are you about making a move?",
                            type: "rating",
                            maxStars: 5,
                            labels: "Rate your readiness",
                            conditions: { enabled: false, showIf: null }
                        }
                    ]
                }
            },
            'ecommerce': {
                name: 'üõí E-Commerce',
                description: 'For online stores and product recommendations',
                template: {
                    branding: {
                        logo: "üõí",
                        brandName: "Product Finder",
                        primaryColor: "#ff6b6b",
                        secondaryColor: "#ee5a6f",
                        accentColor: "#c44569"
                    },
                    welcome: {
                        title: "Find Your Perfect Product!",
                        subtitle: "Answer a few questions to get personalized recommendations",
                        buttonText: "Start Shopping üõçÔ∏è",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "What's your budget range?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Under $50", icon: "üíµ", score: 10, nextQuestion: null },
                                { id: "b", text: "$50 - $100", icon: "üí∏", score: 20, nextQuestion: null },
                                { id: "c", text: "$100 - $200", icon: "üíé", score: 30, nextQuestion: null },
                                { id: "d", text: "Over $200", icon: "üëë", score: 40, nextQuestion: null }
                            ],
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 2,
                            question: "How important is brand name to you?",
                            type: "slider",
                            min: 0,
                            max: 100,
                            step: 10,
                            defaultValue: 50,
                            labels: { 0: "Not important", 50: "Somewhat", 100: "Very important" },
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 3,
                            question: "Rate your shopping urgency",
                            type: "rating",
                            maxStars: 5,
                            labels: "1 = Just browsing, 5 = Need it now!",
                            conditions: { enabled: false, showIf: null }
                        }
                    ]
                }
            },
            'education': {
                name: 'üìö Education & Training',
                description: 'For courses, coaching, and learning programs',
                template: {
                    branding: {
                        logo: "üìö",
                        brandName: "Learning Path Finder",
                        primaryColor: "#5f27cd",
                        secondaryColor: "#341f97",
                        accentColor: "#2e86de"
                    },
                    welcome: {
                        title: "Discover Your Perfect Learning Path!",
                        subtitle: "Find the course that matches your goals and learning style",
                        buttonText: "Start Assessment üìñ",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "What's your current skill level?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Complete beginner", icon: "üå±", score: 10, nextQuestion: null },
                                { id: "b", text: "Some experience", icon: "üåø", score: 20, nextQuestion: null },
                                { id: "c", text: "Intermediate", icon: "üå≥", score: 30, nextQuestion: null },
                                { id: "d", text: "Advanced", icon: "üéì", score: 40, nextQuestion: null }
                            ],
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 2,
                            question: "How much time can you dedicate per week?",
                            type: "slider",
                            min: 0,
                            max: 20,
                            step: 2,
                            defaultValue: 5,
                            labels: { 0: "0 hours", 10: "10 hours", 20: "20+ hours" },
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 3,
                            question: "Are you ready to invest in your education?",
                            type: "yes-no",
                            yesLabel: "Yes, I'm committed!",
                            noLabel: "Still exploring options",
                            yesScore: 50,
                            noScore: 20,
                            conditions: { enabled: false, showIf: null }
                        }
                    ]
                }
            },
            'healthcare': {
                name: '‚öïÔ∏è Healthcare & Wellness',
                description: 'For health assessments and wellness programs',
                template: {
                    branding: {
                        logo: "‚öïÔ∏è",
                        brandName: "Wellness Assessment",
                        primaryColor: "#26de81",
                        secondaryColor: "#20bf6b",
                        accentColor: "#0fb9b1"
                    },
                    welcome: {
                        title: "Your Personal Wellness Check!",
                        subtitle: "Take this quick assessment to get personalized health recommendations",
                        buttonText: "Begin Assessment üíö",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "How would you rate your current health?",
                            type: "rating",
                            maxStars: 5,
                            labels: "1 = Poor, 5 = Excellent",
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 2,
                            question: "Do you currently exercise regularly?",
                            type: "yes-no",
                            yesLabel: "Yes, regularly",
                            noLabel: "No, rarely or never",
                            yesScore: 50,
                            noScore: 10,
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 3,
                            question: "What's your main health goal?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Lose weight", icon: "‚öñÔ∏è", score: 10, nextQuestion: null },
                                { id: "b", text: "Build strength", icon: "üí™", score: 20, nextQuestion: null },
                                { id: "c", text: "Reduce stress", icon: "üßò", score: 30, nextQuestion: null },
                                { id: "d", text: "Improve sleep", icon: "üò¥", score: 40, nextQuestion: null }
                            ],
                            conditions: { enabled: false, showIf: null }
                        }
                    ]
                }
            },
            'saas': {
                name: 'üíª SaaS & Tech',
                description: 'For software products and tech solutions',
                template: {
                    branding: {
                        logo: "üíª",
                        brandName: "Solution Matcher",
                        primaryColor: "#6c5ce7",
                        secondaryColor: "#a29bfe",
                        accentColor: "#fd79a8"
                    },
                    welcome: {
                        title: "Find Your Perfect Software Solution!",
                        subtitle: "Discover which plan and features are right for your needs",
                        buttonText: "Get Started üöÄ",
                        backgroundStyle: "gradient"
                    },
                    questions: [
                        {
                            id: 1,
                            question: "What's the size of your team?",
                            type: "multiple-choice",
                            options: [
                                { id: "a", text: "Just me (Solo)", icon: "üë§", score: 10, nextQuestion: null },
                                { id: "b", text: "2-10 people", icon: "üë•", score: 20, nextQuestion: null },
                                { id: "c", text: "11-50 people", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", score: 30, nextQuestion: null },
                                { id: "d", text: "50+ people", icon: "üè¢", score: 40, nextQuestion: null }
                            ],
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 2,
                            question: "How tech-savvy is your team?",
                            type: "slider",
                            min: 0,
                            max: 100,
                            step: 10,
                            defaultValue: 50,
                            labels: { 0: "Beginners", 50: "Moderate", 100: "Tech experts" },
                            conditions: { enabled: false, showIf: null }
                        },
                        {
                            id: 3,
                            question: "Do you need integrations with other tools?",
                            type: "yes-no",
                            yesLabel: "Yes, definitely",
                            noLabel: "No, standalone is fine",
                            yesScore: 50,
                            noScore: 20,
                            conditions: { enabled: false, showIf: null }
                        }
                    ]
                }
            }
        };

        // Default quiz template
        const defaultQuizTemplate = {
            id: 'default-quiz',
            branding: {
                logo: "üéØ",
                brandName: "Your Brand",
                primaryColor: "#667eea",
                secondaryColor: "#764ba2",
                accentColor: "#f093fb"
            },
            welcome: {
                title: "Discover Your Perfect Solution!",
                subtitle: "Take this quick 2-minute quiz to get personalized recommendations",
                buttonText: "Start Quiz ‚Üí",
                backgroundStyle: "gradient" // gradient, solid, image
            },
            questions: [
                {
                    id: 1,
                    question: "What's your biggest challenge right now?",
                    type: "multiple-choice",
                    options: [
                        { id: "a", text: "Getting more leads", icon: "üìà", score: 10, nextQuestion: null },
                        { id: "b", text: "Converting leads to customers", icon: "üí∞", score: 20, nextQuestion: null },
                        { id: "c", text: "Managing my time", icon: "‚è∞", score: 30, nextQuestion: null },
                        { id: "d", text: "Scaling my business", icon: "üöÄ", score: 40, nextQuestion: null }
                    ],
                    conditions: {
                        enabled: false,
                        rules: []
                    }
                },
                {
                    id: 2,
                    question: "How motivated are you to make a change?",
                    type: "slider",
                    min: 0,
                    max: 100,
                    step: 10,
                    defaultValue: 50,
                    labels: { 0: "Not ready", 50: "Somewhat ready", 100: "100% ready!" },
                    conditions: {
                        enabled: false,
                        showIf: null // { questionId: 1, answerId: 'a' }
                    }
                },
                {
                    id: 3,
                    question: "Rate your current satisfaction level",
                    type: "rating",
                    maxStars: 5,
                    labels: "How satisfied are you with your current situation?",
                    conditions: {
                        enabled: false,
                        showIf: null
                    }
                },
                {
                    id: 4,
                    question: "Are you ready to invest in yourself?",
                    type: "yes-no",
                    yesLabel: "Yes, I'm ready!",
                    noLabel: "Not yet",
                    yesScore: 50,
                    noScore: 10,
                    yesNextQuestion: null, // Jump to specific question if yes
                    noNextQuestion: null,  // Jump to specific question if no
                    conditions: {
                        enabled: false,
                        showIf: null
                    }
                }
            ],
            leadCapture: {
                title: "Get Your Personalized Results!",
                subtitle: "Enter your email to receive your custom action plan",
                emailPlaceholder: "your.email@example.com",
                firstNamePlaceholder: "First Name",
                lastNamePlaceholder: "Last Name",
                phonePlaceholder: "Phone (optional)",
                collectPhone: false,
                buttonText: "Show My Results üéâ",
                privacyText: "We respect your privacy. Unsubscribe anytime.",
                customFields: [] // { id, label, placeholder, type: 'text'|'tel'|'url', required: boolean }
            },
            results: {
                title: "Your Personalized Results Are Ready! üéâ",
                subtitle: "Based on your answers, here's what we recommend:",
                ctaText: "Book Your Free Consultation",
                ctaUrl: "https://your-ghl-calendar-link.com",
                showScore: true,
                resultTiers: [
                    { minScore: 0, maxScore: 50, title: "Beginner Level", description: "You're just getting started, and that's great!", icon: "üå±" },
                    { minScore: 51, maxScore: 100, title: "Intermediate Level", description: "You're making good progress!", icon: "üìà" },
                    { minScore: 101, maxScore: 150, title: "Advanced Level", description: "You're crushing it!", icon: "üöÄ" }
                ]
            },
            integration: {
                ghlWebhookUrl: "",
                sendToEmail: false,
                emailRecipient: ""
            }
        };

        // Main App Component
        function QuizBuilderApp() {
            const [mode, setMode] = useState('admin'); // admin or player
            const [currentQuiz, setCurrentQuiz] = useState(defaultQuizTemplate);
            const [savedQuizzes, setSavedQuizzes] = useState([]);
            const [playerOnly, setPlayerOnly] = useState(false);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [hasPassword, setHasPassword] = useState(false);

            useEffect(() => {
                // Check URL parameters for player-only mode
                const urlParams = new URLSearchParams(window.location.search);
                const quizId = urlParams.get('quiz');
                const embedMode = urlParams.get('mode');
                
                if (embedMode === 'player' && quizId) {
                    // Player-only mode for embedding (no auth needed)
                    setPlayerOnly(true);
                    setMode('player');
                    
                    // Load quiz from localStorage
                    const saved = localStorage.getItem('quizzes');
                    if (saved) {
                        const quizzes = JSON.parse(saved);
                        const foundQuiz = quizzes.find(q => q.id === quizId);
                        if (foundQuiz) {
                            setCurrentQuiz(foundQuiz);
                        }
                    }
                } else {
                    // Admin mode - check authentication
                    const savedPassword = localStorage.getItem('admin_password');
                    const sessionAuth = sessionStorage.getItem('admin_authenticated');
                    
                    if (savedPassword) {
                        setHasPassword(true);
                        if (sessionAuth === 'true') {
                            setIsAuthenticated(true);
                        } else {
                            setShowLogin(true);
                        }
                    } else {
                        // No password set yet - show setup
                        setIsAuthenticated(false);
                        setShowLogin(true);
                    }
                    
                    // Load saved quizzes
                    const saved = localStorage.getItem('quizzes');
                    if (saved) {
                        setSavedQuizzes(JSON.parse(saved));
                    }
                }
            }, []);

            const saveQuiz = (quiz) => {
                const quizzes = [...savedQuizzes];
                const existingIndex = quizzes.findIndex(q => q.id === quiz.id);
                
                if (existingIndex >= 0) {
                    quizzes[existingIndex] = quiz;
                } else {
                    quizzes.push(quiz);
                }
                
                setSavedQuizzes(quizzes);
                localStorage.setItem('quizzes', JSON.stringify(quizzes));
                setCurrentQuiz(quiz);
            };

            const loadQuiz = (quizId) => {
                const quiz = savedQuizzes.find(q => q.id === quizId);
                if (quiz) {
                    setCurrentQuiz(quiz);
                }
            };

            const createNewQuiz = () => {
                const newQuiz = {
                    ...defaultQuizTemplate,
                    id: `quiz-${Date.now()}`
                };
                setCurrentQuiz(newQuiz);
            };

            const handleLogout = () => {
                sessionStorage.removeItem('admin_authenticated');
                setIsAuthenticated(false);
                setShowLogin(true);
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Show login screen if not authenticated and not in player-only mode */}
                    {!playerOnly && showLogin && !isAuthenticated && (
                        <LoginSetup 
                            hasPassword={hasPassword}
                            onAuthenticated={() => {
                                setIsAuthenticated(true);
                                setShowLogin(false);
                            }}
                        />
                    )}

                    {/* Show main app only if authenticated or in player-only mode */}
                    {(isAuthenticated || playerOnly) && (
                        <>
                            {/* Top Navigation - Hidden in player-only mode */}
                            {!playerOnly && (
                                <nav className="bg-white border-b border-gray-200 sticky top-0 z-50 card-shadow">
                                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                        <div className="flex justify-between items-center h-16">
                                            <div className="flex items-center space-x-3">
                                                <span className="text-3xl">üéØ</span>
                                                <span className="text-xl font-bold text-gray-800">Quiz Builder Pro</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <button
                                                    onClick={() => setMode('admin')}
                                                    className={`px-6 py-2 rounded-lg font-semibold transition-all ${
                                                        mode === 'admin'
                                                            ? 'bg-purple-600 text-white'
                                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                                    }`}
                                                >
                                                    ‚öôÔ∏è Admin
                                                </button>
                                                <button
                                                    onClick={() => setMode('player')}
                                                    className={`px-6 py-2 rounded-lg font-semibold transition-all ${
                                                        mode === 'player'
                                                            ? 'bg-purple-600 text-white'
                                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                                    }`}
                                                >
                                                    üëÅÔ∏è Preview
                                                </button>
                                                <button
                                                    onClick={handleLogout}
                                                    className="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-all"
                                                    title="Logout"
                                                >
                                                    üö™ Logout
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </nav>
                            )}

                            {/* Main Content */}
                            {playerOnly ? (
                                // Player-only mode (for embedding)
                                <QuizPlayer quiz={currentQuiz} />
                            ) : (
                                // Normal mode (admin + preview)
                                <>
                                    {mode === 'admin' ? (
                                        <AdminPanel
                                            quiz={currentQuiz}
                                            onSave={saveQuiz}
                                            onLoad={loadQuiz}
                                            onNew={createNewQuiz}
                                            savedQuizzes={savedQuizzes}
                                        />
                                    ) : (
                                        <QuizPlayer quiz={currentQuiz} />
                                    )}
                                </>
                            )}
                        </>
                    )}
                </div>
            );
        }

        // Login/Setup Component
        function LoginSetup({ hasPassword, onAuthenticated }) {
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [isSetup, setIsSetup] = useState(!hasPassword);

            const handleSetup = (e) => {
                e.preventDefault();
                setError('');

                if (password.length < 6) {
                    setError('Password must be at least 6 characters');
                    return;
                }

                if (password !== confirmPassword) {
                    setError('Passwords do not match');
                    return;
                }

                // Save password (hashed with simple method)
                const hashedPassword = btoa(password); // Simple encoding
                localStorage.setItem('admin_password', hashedPassword);
                sessionStorage.setItem('admin_authenticated', 'true');
                onAuthenticated();
            };

            const handleLogin = (e) => {
                e.preventDefault();
                setError('');

                const savedPassword = localStorage.getItem('admin_password');
                const hashedInput = btoa(password);

                if (hashedInput === savedPassword) {
                    sessionStorage.setItem('admin_authenticated', 'true');
                    onAuthenticated();
                } else {
                    setError('Incorrect password');
                    setPassword('');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4" style={{
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                }}>
                    <div className="w-full max-w-md">
                        <div className="bg-white rounded-3xl p-8 card-shadow-lg fade-in">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">üîê</div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                    {isSetup ? 'Setup Admin Password' : 'Admin Login'}
                                </h1>
                                <p className="text-gray-600">
                                    {isSetup 
                                        ? 'Create a secure password to protect your Quiz Builder'
                                        : 'Enter your password to access the admin panel'
                                    }
                                </p>
                            </div>

                            <form onSubmit={isSetup ? handleSetup : handleLogin} className="space-y-4">
                                {isSetup ? (
                                    <>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Create Password
                                            </label>
                                            <input
                                                type="password"
                                                value={password}
                                                onChange={(e) => setPassword(e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                                placeholder="Enter password (min 6 characters)"
                                                required
                                                autoFocus
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Confirm Password
                                            </label>
                                            <input
                                                type="password"
                                                value={confirmPassword}
                                                onChange={(e) => setConfirmPassword(e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                                placeholder="Confirm password"
                                                required
                                            />
                                        </div>
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                            <p className="text-xs text-blue-800">
                                                <strong>üí° Important:</strong> Remember this password! It's stored locally on this device. If you forget it, you'll need to reset your browser data.
                                            </p>
                                        </div>
                                    </>
                                ) : (
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                            Password
                                        </label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                            placeholder="Enter your password"
                                            required
                                            autoFocus
                                        />
                                    </div>
                                )}

                                {error && (
                                    <div className="bg-red-50 border border-red-200 rounded-lg p-3 fade-in">
                                        <p className="text-sm text-red-800 font-semibold">‚ùå {error}</p>
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl text-lg font-semibold hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                                >
                                    {isSetup ? 'üîí Setup Password' : 'üîì Login'}
                                </button>
                            </form>

                            {!isSetup && (
                                <div className="mt-6 text-center">
                                    <button
                                        onClick={() => {
                                            if (confirm('‚ö†Ô∏è This will delete your current password and all saved quizzes. Are you sure?')) {
                                                localStorage.removeItem('admin_password');
                                                localStorage.removeItem('quizzes');
                                                sessionStorage.removeItem('admin_authenticated');
                                                window.location.reload();
                                            }
                                        }}
                                        className="text-sm text-gray-500 hover:text-gray-700 underline"
                                    >
                                        Forgot password? Reset everything
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Admin Panel Component
        function AdminPanel({ quiz, onSave, onLoad, onNew, savedQuizzes }) {
            const [activeTab, setActiveTab] = useState('templates');
            const [localQuiz, setLocalQuiz] = useState(quiz);
            const [saveMessage, setSaveMessage] = useState('');
            const [analytics, setAnalytics] = useState({
                views: 0,
                starts: 0,
                completions: 0,
                leads: 0,
                averageScore: 0
            });
            const [selfContainedUrl, setSelfContainedUrl] = useState('');
            const [embedCode, setEmbedCode] = useState('');

            useEffect(() => {
                setLocalQuiz(quiz);
                // Load analytics from localStorage
                const savedAnalytics = localStorage.getItem(`analytics-${quiz.id}`);
                if (savedAnalytics) {
                    setAnalytics(JSON.parse(savedAnalytics));
                }
                
                // Generate self-contained URLs
                generateSelfContainedUrls();
            }, [quiz]);
            
            const generateSelfContainedUrls = () => {
                try {
                    // Create clean quiz object (remove any functions or circular refs)
                    const cleanQuiz = {
                        id: localQuiz.id,
                        branding: localQuiz.branding,
                        welcome: localQuiz.welcome,
                        questions: localQuiz.questions,
                        leadCapture: localQuiz.leadCapture,
                        results: localQuiz.results,
                        integration: localQuiz.integration
                    };
                    
                    const quizJson = JSON.stringify(cleanQuiz);
                    
                    // Unicode-safe base64 encoding (supports emojis and special chars)
                    const encodedData = btoa(unescape(encodeURIComponent(quizJson)));
                    
                    const baseUrl = `${window.location.origin}${window.location.pathname}`;
                    
                    setSelfContainedUrl(`${baseUrl}?mode=player&data=${encodedData}`);
                    
                    // Generate embed code
                    const width = '100%';
                    const height = '800px';
                    setEmbedCode(`<iframe src="${baseUrl}?mode=player&data=${encodedData}" width="${width}" height="${height}" frameborder="0" style="border:none;border-radius:12px;"></iframe>`);
                } catch (error) {
                    console.error('Error generating URLs:', error);
                    setSelfContainedUrl(`Error: ${error.message}`);
                    setEmbedCode(`Error: ${error.message}`);
                }
            };
            
            const updateEmbedCode = (width, height) => {
                try {
                    const cleanQuiz = {
                        id: localQuiz.id,
                        branding: localQuiz.branding,
                        welcome: localQuiz.welcome,
                        questions: localQuiz.questions,
                        leadCapture: localQuiz.leadCapture,
                        results: localQuiz.results,
                        integration: localQuiz.integration
                    };
                    
                    const quizJson = JSON.stringify(cleanQuiz);
                    
                    // Unicode-safe base64 encoding
                    const encodedData = btoa(unescape(encodeURIComponent(quizJson)));
                    
                    const baseUrl = `${window.location.origin}${window.location.pathname}`;
                    
                    setEmbedCode(`<iframe src="${baseUrl}?mode=player&data=${encodedData}" width="${width}" height="${height}" frameborder="0" style="border:none;border-radius:12px;"></iframe>`);
                } catch (error) {
                    console.error('Error updating embed code:', error);
                    setEmbedCode(`Error: ${error.message}`);
                }
            };

            const updateQuiz = (path, value) => {
                const newQuiz = { ...localQuiz };
                const keys = path.split('.');
                let current = newQuiz;
                
                for (let i = 0; i < keys.length - 1; i++) {
                    current = current[keys[i]];
                }
                
                current[keys[keys.length - 1]] = value;
                setLocalQuiz(newQuiz);
            };

            const handleSave = () => {
                onSave(localQuiz);
                setSaveMessage('‚úÖ Quiz saved successfully!');
                setTimeout(() => setSaveMessage(''), 3000);
            };

            const addQuestion = () => {
                const newQuestion = {
                    id: localQuiz.questions.length + 1,
                    question: "New Question",
                    type: "multiple-choice", // Default type
                    options: [
                        { id: "a", text: "Option 1", icon: "‚ú®", score: 10 },
                        { id: "b", text: "Option 2", icon: "üí°", score: 20 }
                    ]
                };
                
                updateQuiz('questions', [...localQuiz.questions, newQuestion]);
            };
            
            const changeQuestionType = (index, newType) => {
                const questions = [...localQuiz.questions];
                const question = { ...questions[index] };
                question.type = newType;
                
                // Initialize conditions if not present
                if (!question.conditions) {
                    question.conditions = { enabled: false, showIf: null };
                }
                
                // Set defaults based on type
                if (newType === 'slider') {
                    question.min = 0;
                    question.max = 100;
                    question.step = 10;
                    question.defaultValue = 50;
                    question.labels = { 0: "Not at all", 50: "Somewhat", 100: "Absolutely!" };
                    delete question.options;
                } else if (newType === 'rating') {
                    question.maxStars = 5;
                    delete question.options;
                } else if (newType === 'yes-no') {
                    question.yesLabel = "Yes, absolutely!";
                    question.noLabel = "No, not yet";
                    question.yesScore = 50;
                    question.noScore = 10;
                    question.yesNextQuestion = null;
                    question.noNextQuestion = null;
                    delete question.options;
                } else if (newType === 'multiple-choice') {
                    if (!question.options) {
                        question.options = [
                            { id: "a", text: "Option 1", icon: "‚ú®", score: 10, nextQuestion: null },
                            { id: "b", text: "Option 2", icon: "üí°", score: 20, nextQuestion: null }
                        ];
                    }
                }
                
                questions[index] = question;
                updateQuiz('questions', questions);
            };

            const updateQuestion = (index, field, value) => {
                const questions = [...localQuiz.questions];
                questions[index][field] = value;
                updateQuiz('questions', questions);
            };

            const deleteQuestion = (index) => {
                const questions = localQuiz.questions.filter((_, i) => i !== index);
                updateQuiz('questions', questions);
            };

            const addOption = (questionIndex) => {
                const questions = [...localQuiz.questions];
                const newOptionId = String.fromCharCode(97 + questions[questionIndex].options.length);
                questions[questionIndex].options.push({
                    id: newOptionId,
                    text: "New Option",
                    icon: "‚ú®",
                    score: 10,
                    nextQuestion: null
                });
                updateQuiz('questions', questions);
            };

            const updateOption = (questionIndex, optionIndex, field, value) => {
                const questions = [...localQuiz.questions];
                questions[questionIndex].options[optionIndex][field] = value;
                updateQuiz('questions', questions);
            };

            const deleteOption = (questionIndex, optionIndex) => {
                const questions = [...localQuiz.questions];
                questions[questionIndex].options.splice(optionIndex, 1);
                updateQuiz('questions', questions);
            };

            const tabs = [
                { id: 'templates', label: 'üìö Templates', icon: 'üìö' },
                { id: 'branding', label: 'üé® Branding', icon: 'üé®' },
                { id: 'welcome', label: 'üëã Welcome Screen', icon: 'üëã' },
                { id: 'questions', label: '‚ùì Questions', icon: '‚ùì' },
                { id: 'lead', label: 'üìß Lead Capture', icon: 'üìß' },
                { id: 'results', label: 'üéâ Results', icon: 'üéâ' },
                { id: 'integration', label: 'üîó Integration', icon: 'üîó' },
                { id: 'analytics', label: 'üìä Analytics', icon: 'üìä' },
                { id: 'share', label: 'üöÄ Share & Publish', icon: 'üöÄ' }
            ];

            return (
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-3xl font-bold text-gray-800">Quiz Configuration</h1>
                        <div className="flex space-x-3">
                            <button
                                onClick={onNew}
                                className="px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-all"
                            >
                                ‚ûï New Quiz
                            </button>
                            <button
                                onClick={handleSave}
                                className="px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-all shadow-lg"
                            >
                                üíæ Save Quiz
                            </button>
                        </div>
                    </div>

                    {saveMessage && (
                        <div className="mb-4 p-4 bg-green-100 border border-green-300 text-green-800 rounded-lg fade-in">
                            {saveMessage}
                        </div>
                    )}

                    {/* Saved Quizzes */}
                    {savedQuizzes.length > 0 && (
                        <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <h3 className="font-semibold text-gray-700 mb-2">üìö Saved Quizzes:</h3>
                            <div className="flex flex-wrap gap-2">
                                {savedQuizzes.map((q) => (
                                    <button
                                        key={q.id}
                                        onClick={() => onLoad(q.id)}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            q.id === localQuiz.id
                                                ? 'bg-purple-600 text-white'
                                                : 'bg-white text-gray-700 hover:bg-purple-100'
                                        }`}
                                    >
                                        {q.branding.brandName}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Tabs */}
                    <div className="bg-white rounded-lg card-shadow mb-6">
                        <div className="border-b border-gray-200">
                            <div className="flex overflow-x-auto">
                                {tabs.map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`px-6 py-4 font-semibold text-sm whitespace-nowrap transition-all ${
                                            activeTab === tab.id
                                                ? 'tab-active'
                                                : 'text-gray-600 hover:text-gray-800'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="p-6">
                            {/* Templates Tab */}
                            {activeTab === 'templates' && (
                                <div className="space-y-6 fade-in">
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-2">Quiz Templates</h2>
                                        <p className="text-gray-600 mb-6">Start with a pre-built template designed for your industry</p>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {Object.entries(quizTemplates).map(([key, template]) => (
                                            <div key={key} className="border-2 border-gray-200 rounded-xl p-6 hover:border-purple-500 transition-all cursor-pointer bg-white hover:shadow-lg">
                                                <div className="text-5xl mb-4">{template.template.branding.logo}</div>
                                                <h3 className="text-xl font-bold text-gray-800 mb-2">{template.name}</h3>
                                                <p className="text-sm text-gray-600 mb-4">{template.description}</p>
                                                <p className="text-xs text-gray-500 mb-4">
                                                    {template.template.questions.length} questions ‚Ä¢ 
                                                    Multiple question types
                                                </p>
                                                <button
                                                    onClick={() => {
                                                        const newQuiz = {
                                                            ...template.template,
                                                            id: `quiz-${Date.now()}`,
                                                            leadCapture: localQuiz.leadCapture,
                                                            results: localQuiz.results,
                                                            integration: localQuiz.integration
                                                        };
                                                        setLocalQuiz(newQuiz);
                                                        setActiveTab('branding');
                                                    }}
                                                    className="w-full px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-all"
                                                >
                                                    Use This Template
                                                </button>
                                            </div>
                                        ))}
                                        
                                        {/* Blank Template */}
                                        <div className="border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-purple-500 transition-all cursor-pointer bg-gray-50 hover:shadow-lg">
                                            <div className="text-5xl mb-4">‚ûï</div>
                                            <h3 className="text-xl font-bold text-gray-800 mb-2">Start From Scratch</h3>
                                            <p className="text-sm text-gray-600 mb-4">Build your own custom quiz from the ground up</p>
                                            <p className="text-xs text-gray-500 mb-4">Complete creative freedom</p>
                                            <button
                                                onClick={() => {
                                                    setActiveTab('branding');
                                                }}
                                                className="w-full px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 transition-all"
                                            >
                                                Start Building
                                            </button>
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
                                        <h3 className="font-semibold text-gray-800 mb-2">üí° Pro Tip:</h3>
                                        <p className="text-sm text-gray-700">
                                            Start with a template to save time, then customize it to match your brand and goals. 
                                            All templates can be fully edited after loading!
                                        </p>
                                    </div>
                                </div>
                            )}

                            {/* Branding Tab */}
                            {activeTab === 'branding' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Brand Settings</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Logo Emoji</label>
                                            <input
                                                type="text"
                                                value={localQuiz.branding.logo}
                                                onChange={(e) => updateQuiz('branding.logo', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input text-3xl text-center"
                                                placeholder="üéØ"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Brand Name</label>
                                            <input
                                                type="text"
                                                value={localQuiz.branding.brandName}
                                                onChange={(e) => updateQuiz('branding.brandName', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                                placeholder="Your Brand"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Primary Color</label>
                                            <div className="flex space-x-2">
                                                <input
                                                    type="color"
                                                    value={localQuiz.branding.primaryColor}
                                                    onChange={(e) => updateQuiz('branding.primaryColor', e.target.value)}
                                                    className="w-20 h-12 border-2 border-gray-200 rounded-lg cursor-pointer"
                                                />
                                                <input
                                                    type="text"
                                                    value={localQuiz.branding.primaryColor}
                                                    onChange={(e) => updateQuiz('branding.primaryColor', e.target.value)}
                                                    className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Secondary Color</label>
                                            <div className="flex space-x-2">
                                                <input
                                                    type="color"
                                                    value={localQuiz.branding.secondaryColor}
                                                    onChange={(e) => updateQuiz('branding.secondaryColor', e.target.value)}
                                                    className="w-20 h-12 border-2 border-gray-200 rounded-lg cursor-pointer"
                                                />
                                                <input
                                                    type="text"
                                                    value={localQuiz.branding.secondaryColor}
                                                    onChange={(e) => updateQuiz('branding.secondaryColor', e.target.value)}
                                                    className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Welcome Tab */}
                            {activeTab === 'welcome' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Welcome Screen</h2>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                                        <input
                                            type="text"
                                            value={localQuiz.welcome.title}
                                            onChange={(e) => updateQuiz('welcome.title', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Subtitle</label>
                                        <textarea
                                            value={localQuiz.welcome.subtitle}
                                            onChange={(e) => updateQuiz('welcome.subtitle', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                            rows="3"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Button Text</label>
                                        <input
                                            type="text"
                                            value={localQuiz.welcome.buttonText}
                                            onChange={(e) => updateQuiz('welcome.buttonText', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>
                                </div>
                            )}

                            {/* Questions Tab */}
                            {activeTab === 'questions' && (
                                <div className="space-y-6 fade-in">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800">Questions</h2>
                                        <button
                                            onClick={addQuestion}
                                            className="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-all"
                                        >
                                            ‚ûï Add Question
                                        </button>
                                    </div>

                                    {localQuiz.questions.map((question, qIndex) => (
                                        <div key={question.id} className="border-2 border-gray-200 rounded-lg p-6 space-y-4 bg-gray-50">
                                            <div className="flex justify-between items-start">
                                                <h3 className="text-lg font-bold text-gray-700">Question {qIndex + 1}</h3>
                                                <button
                                                    onClick={() => deleteQuestion(qIndex)}
                                                    className="px-3 py-1 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600"
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </div>

                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div className="md:col-span-2">
                                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Question Text</label>
                                                    <input
                                                        type="text"
                                                        value={question.question}
                                                        onChange={(e) => updateQuestion(qIndex, 'question', e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Question Type</label>
                                                    <select
                                                        value={question.type}
                                                        onChange={(e) => changeQuestionType(qIndex, e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                    >
                                                        <option value="multiple-choice">Multiple Choice</option>
                                                        <option value="slider">Slider/Range</option>
                                                        <option value="rating">Star Rating</option>
                                                        <option value="yes-no">Yes/No Toggle</option>
                                                    </select>
                                                </div>
                                            </div>

                                            {/* Multiple Choice Options */}
                                            {question.type === 'multiple-choice' && (
                                                <div>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <label className="block text-sm font-semibold text-gray-700">Options</label>
                                                        <button
                                                            onClick={() => addOption(qIndex)}
                                                            className="px-3 py-1 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600"
                                                        >
                                                            ‚ûï Add Option
                                                        </button>
                                                    </div>

                                                    {question.options.map((option, oIndex) => (
                                                        <div key={option.id} className="bg-white border border-gray-200 rounded-lg p-3 mb-3">
                                                            <div className="flex space-x-2 mb-2">
                                                                <input
                                                                    type="text"
                                                                    value={option.icon}
                                                                    onChange={(e) => updateOption(qIndex, oIndex, 'icon', e.target.value)}
                                                                    className="w-16 px-2 py-2 border-2 border-gray-200 rounded-lg text-center text-xl"
                                                                    placeholder="üéØ"
                                                                />
                                                                <input
                                                                    type="text"
                                                                    value={option.text}
                                                                    onChange={(e) => updateOption(qIndex, oIndex, 'text', e.target.value)}
                                                                    className="flex-1 px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                                    placeholder="Option text"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={option.score}
                                                                    onChange={(e) => updateOption(qIndex, oIndex, 'score', parseInt(e.target.value))}
                                                                    className="w-20 px-2 py-2 border-2 border-gray-200 rounded-lg text-center"
                                                                    placeholder="10"
                                                                />
                                                                <button
                                                                    onClick={() => deleteOption(qIndex, oIndex)}
                                                                    className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                                                                >
                                                                    üóëÔ∏è
                                                                </button>
                                                            </div>
                                                            
                                                            {/* Skip Logic for this option */}
                                                            <div className="mt-2 pt-2 border-t border-gray-200">
                                                                <label className="text-xs font-semibold text-gray-600 mb-1 block">
                                                                    üîÄ Skip Logic (Optional)
                                                                </label>
                                                                <div className="flex items-center space-x-2">
                                                                    <span className="text-xs text-gray-500">If selected, jump to:</span>
                                                                    <select
                                                                        value={option.nextQuestion || ''}
                                                                        onChange={(e) => updateOption(qIndex, oIndex, 'nextQuestion', e.target.value ? parseInt(e.target.value) : null)}
                                                                        className="flex-1 px-2 py-1 border border-gray-200 rounded text-xs"
                                                                    >
                                                                        <option value="">Next question (default)</option>
                                                                        {localQuiz.questions.map((q, idx) => (
                                                                            idx > qIndex && (
                                                                                <option key={q.id} value={q.id}>
                                                                                    Question {idx + 1}: {q.question.substring(0, 30)}...
                                                                                </option>
                                                                            )
                                                                        ))}
                                                                        <option value="-1">Lead Capture (End Quiz)</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}

                                            {/* Slider Settings */}
                                            {question.type === 'slider' && (
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Min Value</label>
                                                        <input
                                                            type="number"
                                                            value={question.min || 0}
                                                            onChange={(e) => updateQuestion(qIndex, 'min', parseInt(e.target.value))}
                                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Max Value</label>
                                                        <input
                                                            type="number"
                                                            value={question.max || 100}
                                                            onChange={(e) => updateQuestion(qIndex, 'max', parseInt(e.target.value))}
                                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Step</label>
                                                        <input
                                                            type="number"
                                                            value={question.step || 1}
                                                            onChange={(e) => updateQuestion(qIndex, 'step', parseInt(e.target.value))}
                                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Default Value</label>
                                                        <input
                                                            type="number"
                                                            value={question.defaultValue || 50}
                                                            onChange={(e) => updateQuestion(qIndex, 'defaultValue', parseInt(e.target.value))}
                                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                        />
                                                    </div>
                                                </div>
                                            )}

                                            {/* Rating Settings */}
                                            {question.type === 'rating' && (
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Max Stars</label>
                                                    <input
                                                        type="number"
                                                        min="3"
                                                        max="10"
                                                        value={question.maxStars || 5}
                                                        onChange={(e) => updateQuestion(qIndex, 'maxStars', parseInt(e.target.value))}
                                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                    />
                                                </div>
                                            )}

                                            {/* Yes/No Settings */}
                                            {question.type === 'yes-no' && (
                                                <div className="space-y-4">
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Yes Label</label>
                                                            <input
                                                                type="text"
                                                                value={question.yesLabel || "Yes"}
                                                                onChange={(e) => updateQuestion(qIndex, 'yesLabel', e.target.value)}
                                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-sm font-semibold text-gray-700 mb-2">No Label</label>
                                                            <input
                                                                type="text"
                                                                value={question.noLabel || "No"}
                                                                onChange={(e) => updateQuestion(qIndex, 'noLabel', e.target.value)}
                                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Yes Score</label>
                                                            <input
                                                                type="number"
                                                                value={question.yesScore || 50}
                                                                onChange={(e) => updateQuestion(qIndex, 'yesScore', parseInt(e.target.value))}
                                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-sm font-semibold text-gray-700 mb-2">No Score</label>
                                                            <input
                                                                type="number"
                                                                value={question.noScore || 10}
                                                                onChange={(e) => updateQuestion(qIndex, 'noScore', parseInt(e.target.value))}
                                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                                            />
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Skip Logic for Yes/No */}
                                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                                        <h4 className="text-sm font-bold text-gray-700 mb-3">üîÄ Skip Logic (Optional)</h4>
                                                        <div className="grid grid-cols-2 gap-4">
                                                            <div>
                                                                <label className="block text-xs font-semibold text-gray-600 mb-1">If "Yes", jump to:</label>
                                                                <select
                                                                    value={question.yesNextQuestion || ''}
                                                                    onChange={(e) => updateQuestion(qIndex, 'yesNextQuestion', e.target.value ? parseInt(e.target.value) : null)}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                                >
                                                                    <option value="">Next question (default)</option>
                                                                    {localQuiz.questions.map((q, idx) => (
                                                                        idx > qIndex && (
                                                                            <option key={q.id} value={q.id}>
                                                                                Q{idx + 1}: {q.question.substring(0, 25)}...
                                                                            </option>
                                                                        )
                                                                    ))}
                                                                    <option value="-1">Lead Capture (End)</option>
                                                                </select>
                                                            </div>
                                                            <div>
                                                                <label className="block text-xs font-semibold text-gray-600 mb-1">If "No", jump to:</label>
                                                                <select
                                                                    value={question.noNextQuestion || ''}
                                                                    onChange={(e) => updateQuestion(qIndex, 'noNextQuestion', e.target.value ? parseInt(e.target.value) : null)}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                                >
                                                                    <option value="">Next question (default)</option>
                                                                    {localQuiz.questions.map((q, idx) => (
                                                                        idx > qIndex && (
                                                                            <option key={q.id} value={q.id}>
                                                                                Q{idx + 1}: {q.question.substring(0, 25)}...
                                                                            </option>
                                                                        )
                                                                    ))}
                                                                    <option value="-1">Lead Capture (End)</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Show/Hide Conditional Logic - Available for ALL question types */}
                                            <div className="mt-4 pt-4 border-t-2 border-gray-300">
                                                <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                                    <div className="flex items-center justify-between mb-3">
                                                        <h4 className="text-sm font-bold text-gray-700">üëÅÔ∏è Show/Hide Question</h4>
                                                        <label className="flex items-center cursor-pointer">
                                                            <input
                                                                type="checkbox"
                                                                checked={question.conditions?.enabled || false}
                                                                onChange={(e) => {
                                                                    const questions = [...localQuiz.questions];
                                                                    if (!questions[qIndex].conditions) {
                                                                        questions[qIndex].conditions = { enabled: false, showIf: null };
                                                                    }
                                                                    questions[qIndex].conditions.enabled = e.target.checked;
                                                                    updateQuiz('questions', questions);
                                                                }}
                                                                className="w-4 h-4 mr-2"
                                                            />
                                                            <span className="text-xs font-semibold text-gray-600">Enable</span>
                                                        </label>
                                                    </div>
                                                    
                                                    {question.conditions?.enabled && (
                                                        <div className="space-y-3">
                                                            <p className="text-xs text-gray-600 font-semibold">Show this question only if:</p>
                                                            <div className="bg-white rounded p-3 border border-purple-200">
                                                                <div className="text-xs text-gray-500 mb-2">Previous Question:</div>
                                                                <select
                                                                    value={question.conditions?.showIf?.questionId || ''}
                                                                    onChange={(e) => {
                                                                        const questions = [...localQuiz.questions];
                                                                        if (!questions[qIndex].conditions.showIf) {
                                                                            questions[qIndex].conditions.showIf = {};
                                                                        }
                                                                        questions[qIndex].conditions.showIf.questionId = parseInt(e.target.value);
                                                                        updateQuiz('questions', questions);
                                                                    }}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-2"
                                                                >
                                                                    <option value="">Select a previous question...</option>
                                                                    {localQuiz.questions.map((q, idx) => (
                                                                        idx < qIndex && (
                                                                            <option key={q.id} value={q.id}>
                                                                                Question {idx + 1}: {q.question.substring(0, 30)}...
                                                                            </option>
                                                                        )
                                                                    ))}
                                                                </select>
                                                                
                                                                {question.conditions?.showIf?.questionId && (
                                                                    <>
                                                                        <div className="text-xs text-gray-500 mb-2">Answer condition:</div>
                                                                        {(() => {
                                                                            const selectedQ = localQuiz.questions.find(q => q.id === question.conditions?.showIf?.questionId);
                                                                            if (!selectedQ) return null;
                                                                            
                                                                            if (selectedQ.type === 'multiple-choice') {
                                                                                return (
                                                                                    <select
                                                                                        value={question.conditions?.showIf?.answerId || ''}
                                                                                        onChange={(e) => {
                                                                                            const questions = [...localQuiz.questions];
                                                                                            questions[qIndex].conditions.showIf.answerId = e.target.value;
                                                                                            updateQuiz('questions', questions);
                                                                                        }}
                                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                                                    >
                                                                                        <option value="">Select answer...</option>
                                                                                        {selectedQ.options.map(opt => (
                                                                                            <option key={opt.id} value={opt.id}>
                                                                                                {opt.icon} {opt.text}
                                                                                            </option>
                                                                                        ))}
                                                                                    </select>
                                                                                );
                                                                            } else if (selectedQ.type === 'yes-no') {
                                                                                return (
                                                                                    <select
                                                                                        value={question.conditions?.showIf?.answerId || ''}
                                                                                        onChange={(e) => {
                                                                                            const questions = [...localQuiz.questions];
                                                                                            questions[qIndex].conditions.showIf.answerId = e.target.value;
                                                                                            updateQuiz('questions', questions);
                                                                                        }}
                                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                                                    >
                                                                                        <option value="">Select...</option>
                                                                                        <option value="yes">‚úÖ Yes</option>
                                                                                        <option value="no">‚ùå No</option>
                                                                                    </select>
                                                                                );
                                                                            }
                                                                        })()}
                                                                    </>
                                                                )}
                                                            </div>
                                                            <p className="text-xs text-purple-600 italic flex items-start">
                                                                <span className="mr-1">üí°</span>
                                                                <span>Question will be hidden unless the condition is met</span>
                                                            </p>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Lead Capture Tab */}
                            {activeTab === 'lead' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Lead Capture Form</h2>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                                        <input
                                            type="text"
                                            value={localQuiz.leadCapture.title}
                                            onChange={(e) => updateQuiz('leadCapture.title', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Subtitle</label>
                                        <textarea
                                            value={localQuiz.leadCapture.subtitle}
                                            onChange={(e) => updateQuiz('leadCapture.subtitle', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                            rows="2"
                                        />
                                    </div>

                                    <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                        <h3 className="font-semibold text-gray-800 mb-3">üìã Standard Fields</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">First Name Placeholder</label>
                                                <input
                                                    type="text"
                                                    value={localQuiz.leadCapture.firstNamePlaceholder}
                                                    onChange={(e) => updateQuiz('leadCapture.firstNamePlaceholder', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Last Name Placeholder</label>
                                                <input
                                                    type="text"
                                                    value={localQuiz.leadCapture.lastNamePlaceholder}
                                                    onChange={(e) => updateQuiz('leadCapture.lastNamePlaceholder', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Email Placeholder</label>
                                                <input
                                                    type="text"
                                                    value={localQuiz.leadCapture.emailPlaceholder}
                                                    onChange={(e) => updateQuiz('leadCapture.emailPlaceholder', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                                />
                                            </div>

                                            <div>
                                                <label className="flex items-center space-x-2 cursor-pointer mt-8">
                                                    <input
                                                        type="checkbox"
                                                        checked={localQuiz.leadCapture.collectPhone}
                                                        onChange={(e) => updateQuiz('leadCapture.collectPhone', e.target.checked)}
                                                        className="w-5 h-5"
                                                    />
                                                    <span className="text-sm font-semibold text-gray-700">Collect Phone Number</span>
                                                </label>
                                                {localQuiz.leadCapture.collectPhone && (
                                                    <input
                                                        type="text"
                                                        value={localQuiz.leadCapture.phonePlaceholder}
                                                        onChange={(e) => updateQuiz('leadCapture.phonePlaceholder', e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input mt-2"
                                                        placeholder="Phone placeholder"
                                                    />
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Custom Fields Section */}
                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-3">
                                            <h3 className="font-semibold text-gray-800">‚ú® Custom Fields (Optional)</h3>
                                            <button
                                                onClick={() => {
                                                    const customFields = localQuiz.leadCapture.customFields || [];
                                                    const newField = {
                                                        id: `custom_${Date.now()}`,
                                                        label: "Custom Field",
                                                        placeholder: "Enter value...",
                                                        type: "text",
                                                        required: false
                                                    };
                                                    updateQuiz('leadCapture.customFields', [...customFields, newField]);
                                                }}
                                                className="px-3 py-1 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600"
                                            >
                                                ‚ûï Add Field
                                            </button>
                                        </div>

                                        {localQuiz.leadCapture.customFields && localQuiz.leadCapture.customFields.length > 0 ? (
                                            <div className="space-y-3">
                                                {localQuiz.leadCapture.customFields.map((field, index) => (
                                                    <div key={field.id} className="bg-white border border-gray-200 rounded-lg p-3 space-y-2">
                                                        <div className="flex justify-between items-center">
                                                            <span className="text-sm font-semibold text-gray-700">Field {index + 1}</span>
                                                            <button
                                                                onClick={() => {
                                                                    const customFields = localQuiz.leadCapture.customFields.filter((_, i) => i !== index);
                                                                    updateQuiz('leadCapture.customFields', customFields);
                                                                }}
                                                                className="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-2">
                                                            <input
                                                                type="text"
                                                                value={field.label}
                                                                onChange={(e) => {
                                                                    const customFields = [...localQuiz.leadCapture.customFields];
                                                                    customFields[index].label = e.target.value;
                                                                    updateQuiz('leadCapture.customFields', customFields);
                                                                }}
                                                                className="px-3 py-2 border border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none text-sm"
                                                                placeholder="Field Label"
                                                            />
                                                            <input
                                                                type="text"
                                                                value={field.placeholder}
                                                                onChange={(e) => {
                                                                    const customFields = [...localQuiz.leadCapture.customFields];
                                                                    customFields[index].placeholder = e.target.value;
                                                                    updateQuiz('leadCapture.customFields', customFields);
                                                                }}
                                                                className="px-3 py-2 border border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none text-sm"
                                                                placeholder="Placeholder"
                                                            />
                                                            <select
                                                                value={field.type}
                                                                onChange={(e) => {
                                                                    const customFields = [...localQuiz.leadCapture.customFields];
                                                                    customFields[index].type = e.target.value;
                                                                    updateQuiz('leadCapture.customFields', customFields);
                                                                }}
                                                                className="px-3 py-2 border border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none text-sm"
                                                            >
                                                                <option value="text">Text</option>
                                                                <option value="tel">Phone</option>
                                                                <option value="url">URL</option>
                                                                <option value="number">Number</option>
                                                            </select>
                                                            <label className="flex items-center space-x-2 px-3 py-2">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={field.required}
                                                                    onChange={(e) => {
                                                                        const customFields = [...localQuiz.leadCapture.customFields];
                                                                        customFields[index].required = e.target.checked;
                                                                        updateQuiz('leadCapture.customFields', customFields);
                                                                    }}
                                                                    className="w-4 h-4"
                                                                />
                                                                <span className="text-sm text-gray-700">Required</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <p className="text-sm text-gray-600 text-center py-4">No custom fields added yet. Click "Add Field" to create one.</p>
                                        )}
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Button Text</label>
                                        <input
                                            type="text"
                                            value={localQuiz.leadCapture.buttonText}
                                            onChange={(e) => updateQuiz('leadCapture.buttonText', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Privacy Text</label>
                                        <input
                                            type="text"
                                            value={localQuiz.leadCapture.privacyText}
                                            onChange={(e) => updateQuiz('leadCapture.privacyText', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>
                                </div>
                            )}

                            {/* Results Tab */}
                            {activeTab === 'results' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Results Screen</h2>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                                        <input
                                            type="text"
                                            value={localQuiz.results.title}
                                            onChange={(e) => updateQuiz('results.title', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Subtitle</label>
                                        <input
                                            type="text"
                                            value={localQuiz.results.subtitle}
                                            onChange={(e) => updateQuiz('results.subtitle', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">CTA Button Text</label>
                                        <input
                                            type="text"
                                            value={localQuiz.results.ctaText}
                                            onChange={(e) => updateQuiz('results.ctaText', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">CTA URL (GHL Calendar Link)</label>
                                        <input
                                            type="url"
                                            value={localQuiz.results.ctaUrl}
                                            onChange={(e) => updateQuiz('results.ctaUrl', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                            placeholder="https://your-calendar-link.com"
                                        />
                                    </div>

                                    <div>
                                        <label className="flex items-center space-x-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={localQuiz.results.showScore}
                                                onChange={(e) => updateQuiz('results.showScore', e.target.checked)}
                                                className="w-5 h-5"
                                            />
                                            <span className="text-sm font-semibold text-gray-700">Show Score to Users</span>
                                        </label>
                                    </div>
                                </div>
                            )}

                            {/* Integration Tab */}
                            {activeTab === 'integration' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">GoHighLevel Integration</h2>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">GHL Webhook URL</label>
                                        <input
                                            type="url"
                                            value={localQuiz.integration.ghlWebhookUrl}
                                            onChange={(e) => updateQuiz('integration.ghlWebhookUrl', e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none admin-input"
                                            placeholder="https://your-ghl-webhook-url.com/webhook"
                                        />
                                        <p className="text-sm text-gray-500 mt-2">Get this from your GHL workflow automation settings</p>
                                    </div>

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <h3 className="font-semibold text-gray-800 mb-2">üìã Integration Guide:</h3>
                                        <ol className="text-sm text-gray-700 space-y-2 list-decimal list-inside">
                                            <li>Go to your GHL account ‚Üí Automation ‚Üí Workflows</li>
                                            <li>Create a new workflow with "Webhook" trigger</li>
                                            <li>Copy the webhook URL and paste it above</li>
                                            <li>The quiz will send lead data in this format:
                                                <pre className="bg-white p-2 rounded mt-2 text-xs overflow-x-auto">
{`{
  "firstName": "John",
  "lastName": "Doe",
  "fullName": "John Doe",
  "email": "john@email.com",
  "phone": "optional",
  "customFields": {
    "custom_123": "value"
  },
  "answers": {...},
  "score": 120,
  "timestamp": "2024-...",
  "quizId": "quiz-id"
}`}
                                                </pre>
                                            </li>
                                            <li>Map these fields to your GHL custom fields or contact properties</li>
                                        </ol>
                                    </div>
                                </div>
                            )}

                            {/* Analytics Tab */}
                            {activeTab === 'analytics' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Quiz Performance Analytics</h2>
                                    
                                    {/* Key Metrics */}
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                                            <div className="text-3xl mb-2">üëÅÔ∏è</div>
                                            <div className="text-4xl font-bold mb-1">{analytics.views}</div>
                                            <div className="text-sm opacity-90">Total Views</div>
                                        </div>
                                        
                                        <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white">
                                            <div className="text-3xl mb-2">‚ñ∂Ô∏è</div>
                                            <div className="text-4xl font-bold mb-1">{analytics.starts}</div>
                                            <div className="text-sm opacity-90">Quiz Starts</div>
                                        </div>
                                        
                                        <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                                            <div className="text-3xl mb-2">‚úÖ</div>
                                            <div className="text-4xl font-bold mb-1">{analytics.completions}</div>
                                            <div className="text-sm opacity-90">Completions</div>
                                        </div>
                                        
                                        <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white">
                                            <div className="text-3xl mb-2">üìß</div>
                                            <div className="text-4xl font-bold mb-1">{analytics.leads}</div>
                                            <div className="text-sm opacity-90">Leads Captured</div>
                                        </div>
                                    </div>

                                    {/* Conversion Rates */}
                                    <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                                        <h3 className="text-lg font-bold text-gray-800 mb-4">Conversion Metrics</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-sm font-semibold text-gray-700">Start Rate</span>
                                                    <span className="text-sm font-bold text-purple-600">
                                                        {analytics.views > 0 ? Math.round((analytics.starts / analytics.views) * 100) : 0}%
                                                    </span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-3">
                                                    <div
                                                        className="bg-gradient-to-r from-purple-500 to-purple-600 h-3 rounded-full transition-all"
                                                        style={{ width: `${analytics.views > 0 ? (analytics.starts / analytics.views) * 100 : 0}%` }}
                                                    ></div>
                                                </div>
                                            </div>

                                            <div>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-sm font-semibold text-gray-700">Completion Rate</span>
                                                    <span className="text-sm font-bold text-green-600">
                                                        {analytics.starts > 0 ? Math.round((analytics.completions / analytics.starts) * 100) : 0}%
                                                    </span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-3">
                                                    <div
                                                        className="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full transition-all"
                                                        style={{ width: `${analytics.starts > 0 ? (analytics.completions / analytics.starts) * 100 : 0}%` }}
                                                    ></div>
                                                </div>
                                            </div>

                                            <div>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-sm font-semibold text-gray-700">Lead Capture Rate</span>
                                                    <span className="text-sm font-bold text-orange-600">
                                                        {analytics.completions > 0 ? Math.round((analytics.leads / analytics.completions) * 100) : 0}%
                                                    </span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-3">
                                                    <div
                                                        className="bg-gradient-to-r from-orange-500 to-orange-600 h-3 rounded-full transition-all"
                                                        style={{ width: `${analytics.completions > 0 ? (analytics.leads / analytics.completions) * 100 : 0}%` }}
                                                    ></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Average Score */}
                                    <div className="bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-xl p-6">
                                        <h3 className="text-lg font-bold text-gray-800 mb-2">Average Quiz Score</h3>
                                        <div className="text-5xl font-bold text-purple-600 mb-2">
                                            {analytics.leads > 0 ? Math.round(analytics.averageScore / analytics.leads) : 0}
                                        </div>
                                        <p className="text-sm text-gray-600">Based on {analytics.leads} completed quizzes</p>
                                    </div>

                                    {/* Reset Analytics */}
                                    <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                        <h3 className="font-semibold text-red-800 mb-2">‚ö†Ô∏è Reset Analytics</h3>
                                        <p className="text-sm text-red-700 mb-3">
                                            This will clear all analytics data for this quiz. This action cannot be undone.
                                        </p>
                                        <button
                                            onClick={() => {
                                                if (confirm('Are you sure you want to reset all analytics? This cannot be undone.')) {
                                                    const resetAnalytics = {
                                                        views: 0,
                                                        starts: 0,
                                                        completions: 0,
                                                        leads: 0,
                                                        averageScore: 0
                                                    };
                                                    setAnalytics(resetAnalytics);
                                                    localStorage.setItem(`analytics-${localQuiz.id}`, JSON.stringify(resetAnalytics));
                                                }
                                            }}
                                            className="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-all"
                                        >
                                            Reset All Data
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Share & Publish Tab */}
                            {activeTab === 'share' && (
                                <div className="space-y-6 fade-in">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Share & Publish Your Quiz</h2>
                                    
                                    {/* Self-Contained Quiz Link (RECOMMENDED) */}
                                    <div className="bg-gradient-to-br from-green-50 to-teal-50 border-2 border-green-200 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üéØ</div>
                                            <div>
                                                <h3 className="text-xl font-bold text-gray-800">Self-Contained Quiz Link</h3>
                                                <span className="text-xs bg-green-600 text-white px-2 py-1 rounded-full font-semibold">RECOMMENDED ‚≠ê</span>
                                            </div>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">
                                            <strong>‚úÖ Best for production!</strong> Quiz data is embedded in the URL. Works even if you reset the Quiz Builder!
                                        </p>
                                        <div className="flex space-x-2 mb-3">
                                            <input
                                                type="text"
                                                value={selfContainedUrl}
                                                readOnly
                                                className="flex-1 px-4 py-3 border-2 border-green-300 rounded-lg bg-white text-sm font-mono"
                                            />
                                            <button
                                                onClick={() => {
                                                    if (selfContainedUrl.startsWith('Error')) {
                                                        alert('Cannot copy - there is an error generating the link. Check console for details.');
                                                        return;
                                                    }
                                                    navigator.clipboard.writeText(selfContainedUrl);
                                                    alert('‚úÖ Self-contained link copied!');
                                                }}
                                                className="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-all whitespace-nowrap"
                                            >
                                                üìã Copy
                                            </button>
                                        </div>
                                        <div className="bg-white rounded-lg p-3 border border-green-200">
                                            <p className="text-xs text-green-800">
                                                ‚úÖ <strong>Perfect for:</strong> GHL funnels, websites, embeds (reset-proof!)
                                            </p>
                                        </div>
                                    </div>

                                    {/* Self-Contained Embed Code */}
                                    <div className="bg-white border-2 border-green-300 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üåê</div>
                                            <h3 className="text-xl font-bold text-gray-800">Self-Contained Embed Code</h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">
                                            Copy this code for GHL funnels. Quiz data is embedded - reset-proof!
                                        </p>
                                        
                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Width</label>
                                                <select 
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg" 
                                                    id="embedWidth"
                                                    onChange={(e) => {
                                                        const width = e.target.value;
                                                        const height = document.getElementById('embedHeight')?.value || '800px';
                                                        updateEmbedCode(width, height);
                                                    }}
                                                >
                                                    <option value="100%">100% (Responsive)</option>
                                                    <option value="800px">800px</option>
                                                    <option value="600px">600px</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Height</label>
                                                <select 
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg" 
                                                    id="embedHeight"
                                                    onChange={(e) => {
                                                        const height = e.target.value;
                                                        const width = document.getElementById('embedWidth')?.value || '100%';
                                                        updateEmbedCode(width, height);
                                                    }}
                                                >
                                                    <option value="800px">800px</option>
                                                    <option value="1000px">1000px</option>
                                                </select>
                                            </div>
                                        </div>

                                        <textarea
                                            readOnly
                                            value={embedCode}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg bg-gray-50 font-mono text-xs"
                                            rows="4"
                                        />
                                        <button
                                            onClick={() => {
                                                if (embedCode.startsWith('Error')) {
                                                    alert('Cannot copy - there is an error generating the embed code. Check console for details.');
                                                    return;
                                                }
                                                navigator.clipboard.writeText(embedCode);
                                                alert('‚úÖ Embed code copied!');
                                            }}
                                            className="mt-3 px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-all"
                                        >
                                            üìã Copy Embed Code
                                        </button>
                                    </div>

                                    {/* Legacy Link */}
                                    <div className="bg-purple-50 border-2 border-purple-200 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üîó</div>
                                            <h3 className="text-xl font-bold text-gray-800">Legacy Link (Short URL)</h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">
                                            ‚ö†Ô∏è Uses localStorage - will break if you reset. Use self-contained link above instead.
                                        </p>
                                        <div className="flex space-x-2">
                                            <input
                                                type="text"
                                                value={`${window.location.origin}${window.location.pathname}?quiz=${localQuiz.id}&mode=player`}
                                                readOnly
                                                className="flex-1 px-4 py-3 border-2 border-purple-300 rounded-lg bg-white text-sm font-mono"
                                            />
                                            <button
                                                onClick={() => {
                                                    navigator.clipboard.writeText(`${window.location.origin}${window.location.pathname}?quiz=${localQuiz.id}&mode=player`);
                                                    alert('Legacy link copied');
                                                }}
                                                className="px-6 py-3 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-all whitespace-nowrap"
                                            >
                                                üìã Copy
                                            </button>
                                        </div>
                                    </div>

                                    {/* Export/Import */}
                                    <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üíæ</div>
                                            <h3 className="text-xl font-bold text-gray-800">Export / Import Quiz</h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">Backup your quiz or share it with others</p>
                                        
                                        <div className="grid grid-cols-2 gap-4">
                                            <button
                                                onClick={() => {
                                                    const dataStr = JSON.stringify(localQuiz, null, 2);
                                                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                                                    const url = URL.createObjectURL(dataBlob);
                                                    const link = document.createElement('a');
                                                    link.href = url;
                                                    link.download = `quiz-${localQuiz.branding.brandName.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.json`;
                                                    link.click();
                                                }}
                                                className="px-6 py-4 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-all flex items-center justify-center"
                                            >
                                                <span className="mr-2">‚¨áÔ∏è</span> Export Quiz (JSON)
                                            </button>
                                            
                                            <button
                                                onClick={() => {
                                                    const input = document.createElement('input');
                                                    input.type = 'file';
                                                    input.accept = '.json';
                                                    input.onchange = (e) => {
                                                        const file = e.target.files[0];
                                                        const reader = new FileReader();
                                                        reader.onload = (event) => {
                                                            try {
                                                                const imported = JSON.parse(event.target.result);
                                                                imported.id = `quiz-${Date.now()}`; // New ID
                                                                setLocalQuiz(imported);
                                                                alert('Quiz imported successfully!');
                                                            } catch (error) {
                                                                alert('Error importing quiz. Please check the file format.');
                                                            }
                                                        };
                                                        reader.readAsText(file);
                                                    };
                                                    input.click();
                                                }}
                                                className="px-6 py-4 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-all flex items-center justify-center"
                                            >
                                                <span className="mr-2">‚¨ÜÔ∏è</span> Import Quiz (JSON)
                                            </button>
                                        </div>
                                        
                                        <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                                            <p className="text-xs text-blue-800">
                                                üí° <strong>Tip:</strong> Export your quiz to create backups or share with team members. Import to restore or duplicate quizzes.
                                            </p>
                                        </div>
                                    </div>

                                    {/* Preview Mode */}
                                    <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üëÅÔ∏è</div>
                                            <h3 className="text-xl font-bold text-gray-800">Preview Mode</h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">Test your quiz before sharing (Click "üëÅÔ∏è Preview" at the top)</p>
                                        <div className="bg-white rounded-lg p-4 border border-yellow-200">
                                            <h4 className="font-semibold text-gray-700 mb-2">Quick Test Checklist:</h4>
                                            <ul className="text-sm text-gray-600 space-y-1">
                                                <li>‚úÖ Test all question types</li>
                                                <li>‚úÖ Verify conditional logic</li>
                                                <li>‚úÖ Check skip logic paths</li>
                                                <li>‚úÖ Test lead capture form</li>
                                                <li>‚úÖ Review results page</li>
                                                <li>‚úÖ Test on mobile device</li>
                                            </ul>
                                        </div>
                                    </div>

                                    {/* Duplicate Quiz */}
                                    <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üìã</div>
                                            <h3 className="text-xl font-bold text-gray-800">Duplicate Quiz</h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">Create a copy of this quiz for A/B testing or variations</p>
                                        <button
                                            onClick={() => {
                                                const duplicate = {
                                                    ...localQuiz,
                                                    id: `quiz-${Date.now()}`,
                                                    branding: {
                                                        ...localQuiz.branding,
                                                        brandName: localQuiz.branding.brandName + ' (Copy)'
                                                    }
                                                };
                                                onSave(duplicate);
                                                setLocalQuiz(duplicate);
                                                alert('Quiz duplicated successfully!');
                                            }}
                                            className="px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-all"
                                        >
                                            üîÅ Create Duplicate
                                        </button>
                                    </div>

                                    {/* Security Settings */}
                                    <div className="bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-200 rounded-xl p-6">
                                        <div className="flex items-center mb-3">
                                            <div className="text-3xl mr-3">üîê</div>
                                            <h3 className="text-xl font-bold text-gray-800">Security Settings</h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-4">Manage your admin password and security</p>
                                        
                                        <div className="space-y-3">
                                            <button
                                                onClick={() => {
                                                    const oldPassword = prompt('Enter your current password:');
                                                    if (!oldPassword) return;
                                                    
                                                    const savedPassword = localStorage.getItem('admin_password');
                                                    const hashedOld = btoa(oldPassword);
                                                    
                                                    if (hashedOld !== savedPassword) {
                                                        alert('‚ùå Incorrect current password');
                                                        return;
                                                    }
                                                    
                                                    const newPassword = prompt('Enter new password (min 6 characters):');
                                                    if (!newPassword || newPassword.length < 6) {
                                                        alert('‚ùå Password must be at least 6 characters');
                                                        return;
                                                    }
                                                    
                                                    const confirmNew = prompt('Confirm new password:');
                                                    if (newPassword !== confirmNew) {
                                                        alert('‚ùå Passwords do not match');
                                                        return;
                                                    }
                                                    
                                                    const hashedNew = btoa(newPassword);
                                                    localStorage.setItem('admin_password', hashedNew);
                                                    alert('‚úÖ Password changed successfully!');
                                                }}
                                                className="w-full px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-all"
                                            >
                                                üîë Change Password
                                            </button>
                                            
                                            <div className="bg-white rounded-lg p-3 border border-orange-200">
                                                <p className="text-xs text-orange-800">
                                                    <strong>‚ö†Ô∏è Security Note:</strong> Your password is stored locally on this device. Make sure to remember it!
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Quiz Player Component
        function QuizPlayer({ quiz: quizProp }) {
            const [currentStep, setCurrentStep] = useState('welcome');
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answers, setAnswers] = useState({});
            const [leadData, setLeadData] = useState({ 
                firstName: '', 
                lastName: '', 
                email: '', 
                phone: '',
                customFields: {}
            });
            const [totalScore, setTotalScore] = useState(0);
            const [quiz, setQuiz] = useState(null);
            const [loading, setLoading] = useState(true);

            // Load quiz from URL data or localStorage
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const encodedData = urlParams.get('data');
                const quizId = urlParams.get('quiz');
                
                if (encodedData) {
                    // Self-contained mode: Quiz data in URL
                    try {
                        // Unicode-safe base64 decoding (supports emojis and special chars)
                        const decodedData = decodeURIComponent(escape(atob(encodedData)));
                        const quizData = JSON.parse(decodedData);
                        setQuiz(quizData);
                        setLoading(false);
                    } catch (error) {
                        console.error('Error decoding quiz data:', error);
                        // Fallback to localStorage
                        loadFromLocalStorage(quizId);
                    }
                } else if (quizId) {
                    // Legacy mode: Load from localStorage
                    loadFromLocalStorage(quizId);
                } else if (quizProp) {
                    // Preview mode: Use prop
                    setQuiz(quizProp);
                    setLoading(false);
                }
            }, [quizProp]);

            const loadFromLocalStorage = (quizId) => {
                const saved = localStorage.getItem('quizzes');
                if (saved) {
                    const quizzes = JSON.parse(saved);
                    const foundQuiz = quizzes.find(q => q.id === quizId);
                    if (foundQuiz) {
                        setQuiz(foundQuiz);
                    } else if (quizProp) {
                        setQuiz(quizProp);
                    }
                } else if (quizProp) {
                    setQuiz(quizProp);
                }
                setLoading(false);
            };

            // Track analytics
            useEffect(() => {
                if (quiz) {
                    trackAnalytics('views');
                }
            }, [quiz]);

            const trackAnalytics = (metric, value = 1) => {
                if (!quiz || !quiz.id) return;
                
                const analyticsKey = `analytics-${quiz.id}`;
                const savedAnalytics = localStorage.getItem(analyticsKey);
                const analytics = savedAnalytics ? JSON.parse(savedAnalytics) : {
                    views: 0,
                    starts: 0,
                    completions: 0,
                    leads: 0,
                    averageScore: 0
                };

                if (metric === 'averageScore') {
                    analytics.averageScore += value;
                } else {
                    analytics[metric] += value;
                }

                localStorage.setItem(analyticsKey, JSON.stringify(analytics));
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center" style={{
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                    }}>
                        <div className="text-white text-center">
                            <div className="text-6xl mb-4">‚è≥</div>
                            <div className="text-2xl font-bold">Loading quiz...</div>
                        </div>
                    </div>
                );
            }

            if (!quiz) {
                return (
                    <div className="min-h-screen flex items-center justify-center" style={{
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                    }}>
                        <div className="bg-white rounded-3xl p-8 md:p-12 card-shadow-lg text-center max-w-md">
                            <div className="text-6xl mb-4">‚ùå</div>
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Quiz Not Found</h2>
                            <p className="text-gray-600">This quiz could not be loaded. Please check the URL or contact the quiz creator.</p>
                        </div>
                    </div>
                );
            }

            const totalQuestions = quiz.questions.length;
            const progress = (currentQuestion / totalQuestions) * 100;

            // Check if question should be displayed based on conditions
            const shouldShowQuestion = (question) => {
                if (!question.conditions || !question.conditions.enabled || !question.conditions.showIf) {
                    return true; // No conditions, always show
                }

                const condition = question.conditions.showIf;
                const previousAnswer = answers[condition.questionId];

                // Check if condition is met
                if (condition.answerId) {
                    return previousAnswer === condition.answerId;
                } else if (condition.minValue !== undefined && condition.maxValue !== undefined) {
                    // For slider questions
                    return previousAnswer >= condition.minValue && previousAnswer <= condition.maxValue;
                } else if (condition.minStars !== undefined) {
                    // For rating questions
                    return previousAnswer >= condition.minStars;
                }

                return true;
            };

            // Get next question index based on conditional logic
            const getNextQuestionIndex = (currentIndex, selectedAnswer) => {
                const currentQ = quiz.questions[currentIndex];
                
                // Check for answer-specific skip logic (multiple choice)
                if (currentQ.type === 'multiple-choice' && currentQ.options) {
                    const selectedOption = currentQ.options.find(opt => opt.id === selectedAnswer);
                    if (selectedOption && selectedOption.nextQuestion !== null && selectedOption.nextQuestion !== undefined) {
                        // Find the index of the target question
                        const targetIndex = quiz.questions.findIndex(q => q.id === selectedOption.nextQuestion);
                        if (targetIndex !== -1) return targetIndex;
                    }
                }

                // Check for yes/no specific skip logic
                if (currentQ.type === 'yes-no') {
                    if (selectedAnswer === 'yes' && currentQ.yesNextQuestion !== null && currentQ.yesNextQuestion !== undefined) {
                        const targetIndex = quiz.questions.findIndex(q => q.id === currentQ.yesNextQuestion);
                        if (targetIndex !== -1) return targetIndex;
                    } else if (selectedAnswer === 'no' && currentQ.noNextQuestion !== null && currentQ.noNextQuestion !== undefined) {
                        const targetIndex = quiz.questions.findIndex(q => q.id === currentQ.noNextQuestion);
                        if (targetIndex !== -1) return targetIndex;
                    }
                }

                // Default: find next visible question
                let nextIndex = currentIndex + 1;
                while (nextIndex < quiz.questions.length) {
                    if (shouldShowQuestion(quiz.questions[nextIndex])) {
                        return nextIndex;
                    }
                    nextIndex++;
                }

                // No more questions, go to lead capture
                return -1;
            };

            const handleStartQuiz = () => {
                setCurrentStep('quiz');
                setAnswers({});
                setCurrentQuestion(0);
                setTotalScore(0);
                trackAnalytics('starts'); // Track quiz start
            };

            const handleAnswerSelect = (questionId, answerId) => {
                const question = quiz.questions.find(q => q.id === questionId);
                const option = question.options.find(o => o.id === answerId);
                
                setAnswers({ ...answers, [questionId]: answerId });
                setTotalScore(totalScore + (option.score || 0));
                
                setTimeout(() => {
                    const nextIndex = getNextQuestionIndex(currentQuestion, answerId);
                    
                    if (nextIndex === -1) {
                        // No more questions
                        setCurrentStep('lead-capture');
                    } else {
                        setCurrentQuestion(nextIndex);
                    }
                }, 400);
            };

            const handleLeadSubmit = async (e) => {
                e.preventDefault();
                
                const quizData = {
                    firstName: leadData.firstName,
                    lastName: leadData.lastName,
                    fullName: `${leadData.firstName} ${leadData.lastName}`,
                    email: leadData.email,
                    phone: leadData.phone,
                    customFields: leadData.customFields,
                    answers: answers,
                    score: totalScore,
                    timestamp: new Date().toISOString(),
                    quizId: quiz.id
                };
                
                console.log('Quiz Data:', quizData);
                
                // Track analytics
                trackAnalytics('completions');
                trackAnalytics('leads');
                trackAnalytics('averageScore', totalScore);
                
                // Send to GHL if webhook is configured
                if (quiz.integration.ghlWebhookUrl) {
                    try {
                        await fetch(quiz.integration.ghlWebhookUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(quizData)
                        });
                        console.log('Successfully sent to GHL');
                    } catch (error) {
                        console.error('Error sending to GHL:', error);
                    }
                }
                
                setCurrentStep('results');
            };

            const handlePrevious = () => {
                if (currentQuestion > 0) {
                    const prevQuestion = quiz.questions[currentQuestion - 1];
                    const prevOption = prevQuestion.options.find(o => o.id === answers[prevQuestion.id]);
                    setTotalScore(totalScore - (prevOption?.score || 0));
                    setCurrentQuestion(currentQuestion - 1);
                }
            };

            const getResultTier = () => {
                if (!quiz.results.showScore) return null;
                return quiz.results.resultTiers.find(
                    tier => totalScore >= tier.minScore && totalScore <= tier.maxScore
                ) || quiz.results.resultTiers[0];
            };

            const resultTier = getResultTier();

            const gradientStyle = {
                background: `linear-gradient(135deg, ${quiz.branding.primaryColor} 0%, ${quiz.branding.secondaryColor} 100%)`
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4" style={gradientStyle}>
                    <div className="w-full max-w-2xl">
                        {/* Welcome Screen */}
                        {currentStep === 'welcome' && (
                            <div className="bg-white rounded-3xl p-8 md:p-12 card-shadow-lg fade-in text-center">
                                <div className="text-6xl mb-6">{quiz.branding.logo}</div>
                                <h1 className="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                                    {quiz.welcome.title}
                                </h1>
                                <p className="text-xl text-gray-600 mb-8">
                                    {quiz.welcome.subtitle}
                                </p>
                                <button
                                    onClick={handleStartQuiz}
                                    className="px-8 py-4 rounded-full text-lg font-semibold text-white hover:shadow-xl transition-all duration-300 transform hover:scale-105 pulse-button"
                                    style={gradientStyle}
                                >
                                    {quiz.welcome.buttonText}
                                </button>
                                <p className="text-sm text-gray-500 mt-6">
                                    ‚è±Ô∏è Takes only 2 minutes ‚Ä¢ {totalQuestions} questions
                                </p>
                            </div>
                        )}

                        {/* Quiz Screen */}
                        {currentStep === 'quiz' && (
                            <div className="bg-white rounded-3xl p-8 md:p-12 card-shadow-lg fade-in">
                                <div className="mb-8">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm font-semibold text-gray-600">
                                            Question {currentQuestion + 1} of {totalQuestions}
                                        </span>
                                        <span className="text-sm font-semibold" style={{ color: quiz.branding.primaryColor }}>
                                            {Math.round(progress)}% Complete
                                        </span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                        <div
                                            className="progress-bar h-full rounded-full"
                                            style={{ width: `${progress}%`, ...gradientStyle }}
                                        ></div>
                                    </div>
                                </div>

                                <div className="slide-in">
                                    <h2 className="text-3xl font-bold text-gray-800 mb-8">
                                        {quiz.questions[currentQuestion].question}
                                    </h2>

                                    {/* Multiple Choice Questions */}
                                    {quiz.questions[currentQuestion].type === 'multiple-choice' && (
                                        <div className="space-y-4">
                                            {quiz.questions[currentQuestion].options.map((option) => {
                                                const isSelected = answers[quiz.questions[currentQuestion].id] === option.id;
                                                return (
                                                    <button
                                                        key={option.id}
                                                        onClick={() => handleAnswerSelect(quiz.questions[currentQuestion].id, option.id)}
                                                        className={`w-full p-5 rounded-xl border-2 text-left option-hover transition-all ${
                                                            isSelected
                                                                ? 'option-selected border-transparent text-white'
                                                                : 'border-gray-200 bg-gray-50 hover:border-purple-300'
                                                        }`}
                                                        style={isSelected ? gradientStyle : {}}
                                                    >
                                                        <div className="flex items-center">
                                                            <span className="text-3xl mr-4">{option.icon}</span>
                                                            <span className={`text-lg font-semibold ${
                                                                isSelected ? 'text-white' : 'text-gray-700'
                                                            }`}>
                                                                {option.text}
                                                            </span>
                                                        </div>
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    )}

                                    {/* Slider Question */}
                                    {quiz.questions[currentQuestion].type === 'slider' && (
                                        <div className="space-y-6">
                                            <div className="text-center">
                                                <div className="text-6xl font-bold mb-4" style={{ color: quiz.branding.primaryColor }}>
                                                    {answers[quiz.questions[currentQuestion].id] || quiz.questions[currentQuestion].defaultValue || 50}%
                                                </div>
                                            </div>
                                            
                                            <input
                                                type="range"
                                                min={quiz.questions[currentQuestion].min || 0}
                                                max={quiz.questions[currentQuestion].max || 100}
                                                step={quiz.questions[currentQuestion].step || 1}
                                                value={answers[quiz.questions[currentQuestion].id] || quiz.questions[currentQuestion].defaultValue || 50}
                                                onChange={(e) => {
                                                    const value = parseInt(e.target.value);
                                                    setAnswers({ ...answers, [quiz.questions[currentQuestion].id]: value });
                                                    setTotalScore(totalScore - (answers[quiz.questions[currentQuestion].id] || 0) + value);
                                                }}
                                                className="quiz-slider w-full"
                                            />
                                            
                                            <div className="flex justify-between text-sm text-gray-600 font-semibold">
                                                {quiz.questions[currentQuestion].labels && Object.entries(quiz.questions[currentQuestion].labels).map(([key, label]) => (
                                                    <span key={key}>{label}</span>
                                                ))}
                                            </div>
                                            
                                            <button
                                                onClick={() => {
                                                    const nextIndex = getNextQuestionIndex(currentQuestion, answers[quiz.questions[currentQuestion].id]);
                                                    if (nextIndex === -1) {
                                                        setCurrentStep('lead-capture');
                                                    } else {
                                                        setCurrentQuestion(nextIndex);
                                                    }
                                                }}
                                                className="w-full px-8 py-4 rounded-xl text-lg font-semibold text-white transition-all duration-300 transform hover:scale-105 mt-4"
                                                style={gradientStyle}
                                            >
                                                Continue ‚Üí
                                            </button>
                                        </div>
                                    )}

                                    {/* Rating Stars Question */}
                                    {quiz.questions[currentQuestion].type === 'rating' && (
                                        <div className="space-y-6">
                                            <div className="flex justify-center space-x-2">
                                                {[...Array(quiz.questions[currentQuestion].maxStars || 5)].map((_, index) => {
                                                    const starValue = index + 1;
                                                    const isFilled = starValue <= (answers[quiz.questions[currentQuestion].id] || 0);
                                                    return (
                                                        <button
                                                            key={starValue}
                                                            onClick={() => {
                                                                setAnswers({ ...answers, [quiz.questions[currentQuestion].id]: starValue });
                                                                setTotalScore(totalScore - (answers[quiz.questions[currentQuestion].id] || 0) + (starValue * 10));
                                                            }}
                                                            className={`rating-star ${isFilled ? 'filled' : ''}`}
                                                        >
                                                            ‚≠ê
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                            
                                            {answers[quiz.questions[currentQuestion].id] && (
                                                <div className="text-center">
                                                    <p className="text-2xl font-bold text-gray-700 mb-4">
                                                        {answers[quiz.questions[currentQuestion].id]} out of {quiz.questions[currentQuestion].maxStars || 5} stars
                                                    </p>
                                                    <button
                                                        onClick={() => {
                                                            const nextIndex = getNextQuestionIndex(currentQuestion, answers[quiz.questions[currentQuestion].id]);
                                                            if (nextIndex === -1) {
                                                                setCurrentStep('lead-capture');
                                                            } else {
                                                                setCurrentQuestion(nextIndex);
                                                            }
                                                        }}
                                                        className="px-8 py-4 rounded-xl text-lg font-semibold text-white transition-all duration-300 transform hover:scale-105"
                                                        style={gradientStyle}
                                                    >
                                                        Continue ‚Üí
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* Yes/No Toggle Question */}
                                    {quiz.questions[currentQuestion].type === 'yes-no' && (
                                        <div className="grid grid-cols-2 gap-6">
                                            <button
                                                onClick={() => {
                                                    setAnswers({ ...answers, [quiz.questions[currentQuestion].id]: 'yes' });
                                                    const score = quiz.questions[currentQuestion].yesScore || 50;
                                                    setTotalScore(totalScore - (answers[quiz.questions[currentQuestion].id] === 'yes' ? score : quiz.questions[currentQuestion].noScore || 0) + score);
                                                    setTimeout(() => {
                                                        const nextIndex = getNextQuestionIndex(currentQuestion, 'yes');
                                                        if (nextIndex === -1) {
                                                            setCurrentStep('lead-capture');
                                                        } else {
                                                            setCurrentQuestion(nextIndex);
                                                        }
                                                    }, 400);
                                                }}
                                                className={`toggle-option p-8 rounded-2xl border-2 text-center transition-all ${
                                                    answers[quiz.questions[currentQuestion].id] === 'yes'
                                                        ? 'border-transparent text-white active'
                                                        : 'border-gray-200 bg-gray-50 hover:border-green-300'
                                                }`}
                                                style={answers[quiz.questions[currentQuestion].id] === 'yes' ? gradientStyle : {}}
                                            >
                                                <div className="text-5xl mb-3">‚úÖ</div>
                                                <div className={`text-xl font-bold ${
                                                    answers[quiz.questions[currentQuestion].id] === 'yes' ? 'text-white' : 'text-gray-700'
                                                }`}>
                                                    {quiz.questions[currentQuestion].yesLabel || "Yes"}
                                                </div>
                                            </button>
                                            
                                            <button
                                                onClick={() => {
                                                    setAnswers({ ...answers, [quiz.questions[currentQuestion].id]: 'no' });
                                                    const score = quiz.questions[currentQuestion].noScore || 10;
                                                    setTotalScore(totalScore - (answers[quiz.questions[currentQuestion].id] === 'no' ? score : quiz.questions[currentQuestion].yesScore || 0) + score);
                                                    setTimeout(() => {
                                                        const nextIndex = getNextQuestionIndex(currentQuestion, 'no');
                                                        if (nextIndex === -1) {
                                                            setCurrentStep('lead-capture');
                                                        } else {
                                                            setCurrentQuestion(nextIndex);
                                                        }
                                                    }, 400);
                                                }}
                                                className={`toggle-option p-8 rounded-2xl border-2 text-center transition-all ${
                                                    answers[quiz.questions[currentQuestion].id] === 'no'
                                                        ? 'border-transparent text-white active'
                                                        : 'border-gray-200 bg-gray-50 hover:border-red-300'
                                                }`}
                                                style={answers[quiz.questions[currentQuestion].id] === 'no' ? gradientStyle : {}}
                                            >
                                                <div className="text-5xl mb-3">‚ùå</div>
                                                <div className={`text-xl font-bold ${
                                                    answers[quiz.questions[currentQuestion].id] === 'no' ? 'text-white' : 'text-gray-700'
                                                }`}>
                                                    {quiz.questions[currentQuestion].noLabel || "No"}
                                                </div>
                                            </button>
                                        </div>
                                    )}

                                    {currentQuestion > 0 && (
                                        <button
                                            onClick={handlePrevious}
                                            className="mt-6 text-gray-600 hover:text-gray-800 font-semibold transition-all"
                                        >
                                            ‚Üê Previous Question
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Lead Capture Screen */}
                        {currentStep === 'lead-capture' && (
                            <div className="bg-white rounded-3xl p-8 md:p-12 card-shadow-lg fade-in">
                                <div className="text-center mb-8">
                                    <div className="text-6xl mb-4">üìß</div>
                                    <h2 className="text-3xl font-bold text-gray-800 mb-3">
                                        {quiz.leadCapture.title}
                                    </h2>
                                    <p className="text-lg text-gray-600">
                                        {quiz.leadCapture.subtitle}
                                    </p>
                                </div>

                                <form onSubmit={handleLeadSubmit} className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <input
                                                type="text"
                                                placeholder={quiz.leadCapture.firstNamePlaceholder}
                                                value={leadData.firstName}
                                                onChange={(e) => setLeadData({ ...leadData, firstName: e.target.value })}
                                                className="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none text-lg transition-all"
                                                style={{ borderColor: leadData.firstName ? quiz.branding.primaryColor : '' }}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <input
                                                type="text"
                                                placeholder={quiz.leadCapture.lastNamePlaceholder}
                                                value={leadData.lastName}
                                                onChange={(e) => setLeadData({ ...leadData, lastName: e.target.value })}
                                                className="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none text-lg transition-all"
                                                style={{ borderColor: leadData.lastName ? quiz.branding.primaryColor : '' }}
                                                required
                                            />
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <input
                                            type="email"
                                            placeholder={quiz.leadCapture.emailPlaceholder}
                                            value={leadData.email}
                                            onChange={(e) => setLeadData({ ...leadData, email: e.target.value })}
                                            className="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none text-lg transition-all"
                                            style={{ borderColor: leadData.email ? quiz.branding.primaryColor : '' }}
                                            required
                                        />
                                    </div>
                                    
                                    {quiz.leadCapture.collectPhone && (
                                        <div>
                                            <input
                                                type="tel"
                                                placeholder={quiz.leadCapture.phonePlaceholder}
                                                value={leadData.phone}
                                                onChange={(e) => setLeadData({ ...leadData, phone: e.target.value })}
                                                className="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none text-lg transition-all"
                                                style={{ borderColor: leadData.phone ? quiz.branding.primaryColor : '' }}
                                            />
                                        </div>
                                    )}

                                    {/* Render Custom Fields */}
                                    {quiz.leadCapture.customFields && quiz.leadCapture.customFields.map((field) => (
                                        <div key={field.id}>
                                            <input
                                                type={field.type}
                                                placeholder={field.placeholder}
                                                value={leadData.customFields[field.id] || ''}
                                                onChange={(e) => setLeadData({ 
                                                    ...leadData, 
                                                    customFields: {
                                                        ...leadData.customFields,
                                                        [field.id]: e.target.value
                                                    }
                                                })}
                                                className="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none text-lg transition-all"
                                                style={{ borderColor: leadData.customFields[field.id] ? quiz.branding.primaryColor : '' }}
                                                required={field.required}
                                            />
                                        </div>
                                    ))}

                                    <button
                                        type="submit"
                                        className="w-full px-8 py-4 rounded-xl text-lg font-semibold text-white hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                                        style={gradientStyle}
                                    >
                                        {quiz.leadCapture.buttonText}
                                    </button>
                                    <p className="text-sm text-gray-500 text-center mt-4">
                                        üîí {quiz.leadCapture.privacyText}
                                    </p>
                                </form>
                            </div>
                        )}

                        {/* Results Screen */}
                        {currentStep === 'results' && (
                            <div className="bg-white rounded-3xl p-8 md:p-12 card-shadow-lg fade-in text-center">
                                <div className="text-6xl mb-6">üéâ</div>
                                <h2 className="text-4xl font-bold text-gray-800 mb-4">
                                    {quiz.results.title}
                                </h2>
                                <p className="text-xl text-gray-600 mb-2">
                                    Thank you, {leadData.firstName}!
                                </p>
                                
                                {quiz.results.showScore && resultTier && (
                                    <div className="my-6 p-6 rounded-2xl glassmorphism border-2 border-gray-200">
                                        <div className="text-5xl mb-3">{resultTier.icon}</div>
                                        <h3 className="text-2xl font-bold text-gray-800 mb-2">{resultTier.title}</h3>
                                        <p className="text-lg text-gray-600 mb-3">{resultTier.description}</p>
                                        <div className="text-3xl font-bold" style={{ color: quiz.branding.primaryColor }}>
                                            Score: {totalScore} points
                                        </div>
                                    </div>
                                )}
                                
                                <div className="rounded-2xl p-6 mb-8 text-left" style={{ background: `linear-gradient(135deg, ${quiz.branding.primaryColor}15, ${quiz.branding.secondaryColor}15)` }}>
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4">
                                        {quiz.results.subtitle}
                                    </h3>
                                    <ul className="space-y-3 text-gray-700">
                                        <li className="flex items-start">
                                            <span className="text-2xl mr-3">‚úÖ</span>
                                            <span>Personalized action plan sent to {leadData.email}</span>
                                        </li>
                                        <li className="flex items-start">
                                            <span className="text-2xl mr-3">‚úÖ</span>
                                            <span>Custom recommendations based on your goals</span>
                                        </li>
                                        <li className="flex items-start">
                                            <span className="text-2xl mr-3">‚úÖ</span>
                                            <span>Exclusive resources and next steps</span>
                                        </li>
                                    </ul>
                                </div>

                                <a
                                    href={quiz.results.ctaUrl}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="inline-block px-8 py-4 rounded-full text-lg font-semibold text-white hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                                    style={gradientStyle}
                                >
                                    {quiz.results.ctaText} ‚Üí
                                </a>
                                
                                <p className="text-sm text-gray-500 mt-6">
                                    Check your email for your detailed results!
                                </p>
                                
                                <button
                                    onClick={handleStartQuiz}
                                    className="mt-6 text-gray-600 hover:text-gray-800 font-semibold underline"
                                >
                                    Take Quiz Again
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<QuizBuilderApp />, document.getElementById('root'));
    </script>
</body>
</html>
